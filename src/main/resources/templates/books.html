<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head>
    <meta charset="UTF-8" />
    <title>Book Index</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">HUTECH</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
          <li class="nav-item">
            <a class="nav-link" href="/books">List Book</a>
          </li>
          <li class="nav-item" sec:authorize="hasRole('ADMIN')">
            <a class="nav-link" href="/books/add">Add Book</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="/cart">Cart</a></li>
          <li th:if="${#authorization.expression('isAuthenticated()')}">
            <a class="nav-link" href="/logout">Logout</a>
          </li>
          <li th:if="${#authorization.expression('!isAuthenticated()')}">
            <a class="nav-link" href="/login">Login</a>
          </li>
        </ul>
      </div>
    </nav>
    <div class="container mt-4">
      <h2>My Book List</h2>
      <form th:action="@{/books}" method="get" class="form-inline mb-3">
        <input
          type="text"
          name="keyword"
          class="form-control mr-2"
          placeholder="Search..."
          th:value="${keyword}"
        />
        <button type="submit" class="btn btn-primary">Search</button>
      </form>
      <table class="table table-hover table-bordered">
        <thead class="thead-light">
          <tr>
            <th>
              <a
                th:href="@{/books(sortBy='id',sortDir=${sortDir == 'asc' ? 'desc' : 'asc'})}"
                >Id</a
              >
            </th>
            <th>
              <a
                th:href="@{/books(sortBy='title', sortDir=${sortDir == 'asc' ? 'desc' : 'asc'}, keyword=${keyword})}"
                >Title</a
              >
            </th>
            <th>
              <a
                th:href="@{/books(sortBy='author',sortDir=${sortDir == 'asc' ? 'desc' : 'asc'})}"
                >Author</a
              >
            </th>
            <th>
              <a
                th:href="@{/books(sortBy='price',sortDir=${sortDir == 'asc' ? 'desc' : 'asc'})}"
                >Price</a
              >
            </th>
            <th>Category</th>
            <th style="width: 180px">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="book : ${books}">
            <td th:text="${book.id}"></td>
            <td th:text="${book.title}"></td>
            <td th:text="${book.author}"></td>
            <td th:text="${book.price}"></td>
            <td
              th:text="${book.category != null ? book.category.name : ''}"
            ></td>
            <td>
              <span sec:authorize="hasRole('ADMIN')">
                <a th:href="@{'/books/edit/' + ${book.id}}" class="btn btn-sm btn-primary">Edit</a>
                <a th:href="@{'/books/delete/' + ${book.id}}" class="btn btn-sm btn-danger" onclick="return confirm('Bạn có chắc muốn xóa sách này?');">Delete</a>
              </span>
              <span sec:authorize="isAuthenticated()">
                <a th:href="@{'/cart/add/' + ${book.id}}" class="btn btn-sm btn-success" onclick="return confirm('Are you sure you want to add this book to cart?');">Add to cart</a>
              </span>
            </td>
          </tr>
        </tbody>
      </table>
      <a href="/books/add" class="btn btn-success" sec:authorize="hasRole('ADMIN')">Add New Book</a>
      <nav aria-label="Page navigation">
        <ul class="pagination mt-3">
          <li
            class="page-item"
            th:each="i : ${#numbers.sequence(0, totalPages-1)}"
            th:classappend="${i} == ${currentPage} ? 'active'"
          >
            <a
              class="page-link"
              th:href="@{/books(page=${i}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}"
              th:text="${i+1}"
            ></a>
          </li>
        </ul>
      </nav>
    </div>
  </body>
</html>
